# This is a sample file, for detailed reference see: https://rudderlabs.github.io/pywht/
models:
  - name: &model_name_7_days payer_propensity_model
    model_type: python_model
    model_spec:
      occurred_at_col: insert_ts
      entity_key: user
      py_repo_url: https://github.com/rudderlabs/rudderstack-profiles-classifier.git
      train:
        file_extension: .json
        file_validity: 168h # If the last trained model is older than this, then the model will be trained again,
        inputs: &inputs_7_days
          - models/rudder_user_base_features # inputs to materialise the required data for model
        config:
          data: &model_data_configs_7_days
            label_column: is_churned_7_days # Name of column for which we want to find predictions
            label_value: 1 # Value of label column for which prediction is generated
            prediction_horizon_days: 7 # Number of days in future for which we want to predict
            output_profiles_ml_model: *model_name_7_days # Name of output model based on current model to dinstinguish between multiple models
            eligible_users:
            inputs:
              - packages/base_features/models/rudder_user_base_features
          preprocessing: &model_prep_configs_7_days
            ignore_features:
              - user_email
              - first_name
              - last_name
      predict:
        inputs:
          - models/rudder_user_base_features
        config:
          data: *model_data_configs_7_days # Use the same config as training
          preprocessing: *model_prep_configs_7_days # Use the same config as training
          outputs:
            column_names:
              percentile: &percentile_name_7_days payer_propensity_percentile # Name of column in output table having percentile score
              score: payer_propensity_probability # Name of column in output table having probabilistic score
            feature_meta_data: &feature_meta_data_7_days
              features:
                - name: *percentile_name_7_days
                  description: Percentile score of users likelihood to pay in the next 30 days
      <<: *feature_meta_data_7_days
      contract:
        is_optional: false
        is_event_stream: true
        with_entity_ids: []
        with_columns:
          - name: payer_propensity_percentile
  # - name: &model_name_30_days churn_30_days_model
  #   model_type: python_model
  #   model_spec:
  #     occurred_at_col: insert_ts
  #     entity_key: user
  #     py_repo_url: https://github.com/rudderlabs/rudderstack-profiles-classifier.git
  #     train:
  #       file_extension: .json
  #       file_validity: 168h # If the last trained model is older than this, then the model will be trained again,
  #       inputs: &inputs_30_days
  #         - models/rudder_user_base_features # inputs to materialise the required data for model
  #       config:
  #         data: &model_data_configs_30_days
  #           label_column: is_churned_30_days # Name of column for which we want to find predictions
  #           label_value: 1 # Value of label column for which prediction is generated
  #           prediction_horizon_days: 30 # Number of days in future for which we want to predict
  #           output_profiles_ml_model: *model_name_30_days # Name of output model based on current model to dinstinguish between multiple models
  #           eligible_users:
  #           inputs:
  #             - models/rudder_user_base_features
  #         preprocessing: &model_prep_configs_30_days
  #           ignore_features:
  #             - user_email
  #             - first_name
  #             - last_name
  #     predict:
  #       inputs:
  #         - models/rudder_user_base_features
  #       config:
  #         data: *model_data_configs_30_days # Use the same config as training
  #         preprocessing: *model_prep_configs_30_days # Use the same config as training
  #         outputs:
  #           column_names:
  #             percentile: &percentile_name_30_days percentile_churn_score_30_days # Name of column in output table having percentile score
  #             score: churn_score_30_days # Name of column in output table having probabilistic score
  #           feature_meta_data: &feature_meta_data_30_days
  #             features:
  #               - name: *percentile_name_30_days
  #                 description: "Percentile of churn score. Higher the percentile, higher the probability of churn"
  #     <<: *feature_meta_data_30_days
  #     contract:
  #       is_optional: false
  #       is_event_stream: true
  #       with_entity_ids: []
  #       with_columns:
  #         - name: percentile_churn_score_30_days
  # - name: churn_7_days_propensity
  #   model_type: propensity
  #   model_spec:
  #     entity_key: user
  #     training:
  #       predict_var: entity/user/is_churned_7_days
  #       predict_window_days: 7
  #       label_value: 1
  #     prediction:
  #       output_columns:
  #         percentile:
  #           name: percentile_churn_propensity_7_days
  #           description: "Percentile of churn propensity score. Higher the percentile, higher the probability of churn"
  #         score:
  #           name: churn_propensity_7_days
  #           description: "Probabilistic score of churn propensity"
  #           is_feature: False
  #     inputs:
  #       - models/rudder_user_base_features # inputs to materialise the required data for model        
  # - name: &model_name_90_days churn_90_days_model
  #   model_type: python_model
  #   model_spec:
  #     occurred_at_col: insert_ts
  #     entity_key: user
  #     py_repo_url: https://github.com/rudderlabs/rudderstack-profiles-classifier.git
  #     train:
  #       file_extension: .json
  #       file_validity: 168h # If the last trained model is older than this, then the model will be trained again,
  #       inputs: &inputs_90_days
  #         - models/rudder_user_base_features # inputs to materialise the required data for model
  #       config:
  #         data: &model_data_configs_90_days
  #           label_column: is_churned_90_days # Name of column for which we want to find predictions
  #           label_value: 1 # Value of label column for which prediction is generated
  #           prediction_horizon_days: 90 # Number of days in future for which we want to predict
  #           output_profiles_ml_model: *model_name_90_days # Name of output model based on current model to dinstinguish between multiple models
  #           eligible_users:
  #           inputs:
  #             - packages/base_features/models/rudder_user_base_features
  #         preprocessing: &model_prep_configs_90_days
  #           ignore_features:
  #             - user_email
  #             - first_name
  #             - last_name
  #     predict:
  #       inputs:
  #         - models/rudder_user_base_features
  #       config:
  #         data: *model_data_configs_90_days # Use the same config as training
  #         preprocessing: *model_prep_configs_90_days # Use the same config as training
  #         outputs:
  #           column_names:
  #             percentile: &percentile_name_90_days percentile_churn_score_90_days # Name of column in output table having percentile score
  #             score: churn_score_90_days # Name of column in output table having probabilistic score
  #           feature_meta_data: &feature_meta_data_90_days
  #             features:
  #               - name: *percentile_name_90_days
  #                 description: "Percentile of churn score. Higher the percentile, higher the probability of churn"
  #     <<: *feature_meta_data_90_days
  #     contract:
  #       is_optional: false
  #       is_event_stream: true
  #       with_entity_ids: []
  #       with_columns:
  #         - name: percentile_churn_score_90_days
